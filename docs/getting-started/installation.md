# Installation

## Table of Contents
- [Docker Deployment](#docker-deployment-recommended-for-most-users)
- [Manual Installation](#manual-installation-without-docker)
- [Getting API Credentials](#getting-api-credentials)
- [Cookie Setup](#cookie-setup)
- [Installing ffmpeg](#installing-ffmpeg-example-for-ubuntudebian)
- [Optional: Arabic and Asian fonts](#optional-arabic-and-asian-fonts)
- [Optional: Preparing `yt-dlp` for `/cookies_from_browser`](#optional-preparing-yt-dlp-for-cookies_from_browser)
- [Get YouTube cookies](#get-youtube-cookies)
- [Advanced YouTube Cookie Management](#advanced-youtube-cookie-management)

## üö¢ Docker Deployment (recommended for most users)

This is the easiest way to run the bot: everything (bot + PO token provider + cookie webserver) runs in Docker containers.

### Requirements:
- **Docker** and **Docker Compose**
- A server or VPS with Linux (Ubuntu/Debian recommended)

### Step 1 ‚Äì Create config file:

```bash
git clone https://github.com/chelaxian/tg-ytdlp-bot.git
cd tg-ytdlp-bot
cp CONFIG/_config.py CONFIG/config.py
```

Then edit `CONFIG/config.py` and fill in at least:
- **BOT_NAME** ‚Äì any internal name of your bot
- **BOT_NAME_FOR_USERS** ‚Äì name used in DB (usually real bot username without `@`)
- **ADMIN** ‚Äì list with at least your Telegram user ID
- **API_ID**, **API_HASH** ‚Äì from [my.telegram.org](https://my.telegram.org) (see section [Getting API Credentials](#getting-api-credentials))
- **BOT_TOKEN** ‚Äì from [@BotFather](https://t.me/BotFather) (see section [Getting API Credentials](#getting-api-credentials))
- **LOGS\_*** (LOGS_ID, LOGS_VIDEO_ID, LOGS_NSFW_ID, LOGS_IMG_ID, LOGS_PAID_ID, LOG_EXCEPTION) ‚Äì Fill in all the fields, if you want you can use the same channel for all
- **SUBSCRIBE_CHANNEL** and **SUBSCRIBE_CHANNEL_URL** ‚Äì channel ID and invite link users must join

### Configuration Example:

`tg-ytdlp-bot/CONFIG/config.py`:
```python
#####################################################################
# FILL IN ONLY THAT PART !!!
#####################################################################

# Bot Configuration
BOT_NAME = "your_bot_name"                   # Your bot's name
BOT_NAME_FOR_USERS = "tg-ytdlp-bot"          # Name in database
ADMIN = [123456789]                          # List of admin user IDs
API_ID = 12345678                            # Your Telegram API ID
API_HASH = "your_api_hash_here"              # Your Telegram API Hash
BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"  # Your bot token

# Channel Configuration (Multiple Log Channels)
LOGS_ID = -1001234567890                     # Main logging channel
LOGS_VIDEO_ID = -1001234567890               # Video download logs
LOGS_NSFW_ID = -1001234567890                # NSFW content logs
LOGS_IMG_ID = -1001234567890                 # Image download logs
LOGS_PAID_ID = -1001234567890                # Paid media logs
LOG_EXCEPTION = -1001234567890               # Error logs
SUBSCRIBE_CHANNEL = -1000987654321           # Subscription channel
SUBSCRIBE_CHANNEL_URL = "https://t.me/your_channel"  # Channel invite link

#####################################################################
# LEAVE ALL ANOTHER PARTS UNCHANGED !!!
#####################################################################
```

### Cookies configuration:

First fill in `TXT/cookie.txt` file. That cookie will be used by default for all users. You can paste YouTube cookie here.(see section [Get YouTube cookies](#get-youtube-cookies) below for export and requirements).

```
tg-ytdlp-bot/
‚îî‚îÄ‚îÄ TXT/
    ‚îî‚îÄ‚îÄ cookie.txt
```

`tg-ytdlp-bot/TXT/cookie.txt`:
```
# Netscape HTTP Cookie File
# http://curl.haxx.se/rfc/cookie_spec.html
# This file was generated by Cookie-Editor
.youtube.com  TRUE  /  FALSE  111  ST-xxxxx  session_logininfo=AAA
.youtube.com  TRUE  /  FALSE  222  ST-xxxxx  session_logininfo=BBB
.youtube.com  TRUE  /  FALSE  33333  ST-xxxxx  session_logininfo=CCC
```

Also you can fill in extra cookie files for only services you need (for ex. YouTube, TikTok e.t.c.) and left others unchanged.
You can add up to 10 extra YouTube cookies. They will be used as a backup cookie if previous become invalid.
All cookie URLs in the template already point to the internal `configuration-webserver` container,
you only need to put real cookie files into `docker/configuration-webserver/site/cookies` before starting.
```
tg-ytdlp-bot/
‚îî‚îÄ‚îÄ docker/
    ‚îî‚îÄ‚îÄ configuration-webserver/
        ‚îî‚îÄ‚îÄ site/
            ‚îî‚îÄ‚îÄ cookies/
                ‚îú‚îÄ‚îÄ README.txt
                ‚îú‚îÄ‚îÄ cookie.txt
                ‚îú‚îÄ‚îÄ facebook.txt
                ‚îú‚îÄ‚îÄ instagram.txt
                ‚îú‚îÄ‚îÄ tiktok.txt
                ‚îú‚îÄ‚îÄ twitter.txt
                ‚îú‚îÄ‚îÄ vk.txt
                ‚îú‚îÄ‚îÄ youtube.txt
                ‚îú‚îÄ‚îÄ youtube-1.txt
                ‚îú‚îÄ‚îÄ youtube-[N=2-9].txt
                ‚îî‚îÄ‚îÄ youtube-10.txt
```

`tg-ytdlp-bot/docker/configuration-webserver/site/cookies/youtube.txt`:
```
# Netscape HTTP Cookie File
# http://curl.haxx.se/rfc/cookie_spec.html
# This file was generated by Cookie-Editor
.youtube.com  TRUE  /  FALSE  111  ST-xxxxx  session_logininfo=AAA
.youtube.com  TRUE  /  FALSE  222  ST-xxxxx  session_logininfo=BBB
.youtube.com  TRUE  /  FALSE  33333  ST-xxxxx  session_logininfo=CCC
```

### Step 2 ‚Äì Environment file (.env):

```bash
cp .env.example .env
```

You can optionally change:
- `COMPOSE_PROJECT_NAME` ‚Äì project name prefix for Docker
- `TZ` ‚Äì your timezone (e.g. `Europe/Moscow`)

### Step 3 ‚Äì Start containers:

```bash
docker compose up -d --build
```

The bot container will be built from the included `Dockerfile`, and:
- `configuration-webserver` will serve cookie files at `http://configuration-webserver/cookies/<filename>`
- `bgutil-provider` will be available at `http://bgutil-provider:4416` for YouTube PO tokens
- **Dashboard panel** will be available at `http://localhost:5555` (or `http://<your-server-ip>:5555`)

### Step 4 ‚Äì Access the Dashboard Panel:

After starting the containers, the web dashboard panel will automatically start on port **5555** (configurable via `DASHBOARD_PORT` in `CONFIG/config.py`). You can access it at:
- `http://localhost:5555` (if accessing from the same machine)
- `http://<your-server-ip>:5555` (if accessing remotely)

**Note:** If you change `DASHBOARD_PORT` in the config, make sure to update the port mapping in `docker-compose.yml` accordingly.

**Default credentials:**
- **Username:** `admin` (defined in `CONFIG/config.py` as `DASHBOARD_USERNAME`)
- **Password:** `admin123` (defined in `CONFIG/config.py` as `DASHBOARD_PASSWORD`)

**‚ö†Ô∏è Important:** Change the default password immediately after first login!

**How to change the password:**

1. Log in to the dashboard at `http://<your-server-ip>:5555`
2. Go to the **System** tab
3. Find the **Configuration** section
4. Locate the **Password** field (under "Dashboard authentication")
5. Enter your new password and click **Save**

The password will be automatically updated in `CONFIG/config.py` and will take effect immediately (no restart required).

**Dashboard features:**
- Real-time active users monitoring
- Top downloaders, domains, countries statistics
- NSFW content tracking
- System metrics and configuration management
- User blocking/unblocking functionality
- And much more...

P.S. do not forget to add your bot to your channels with admin rights

---

## Manual Installation (without Docker)

### Prerequisites

- **Python 3.10+**
- **Ubuntu/Debian** (recommended) or other Linux distribution
- **Chromium** (recommended) or other Browser (optional, for `/cookies_from_browser` command)
- **Docker** (optional, for PO Token Provider)
- **Telegram Bot Token** from [@BotFather](https://t.me/BotFather)
- **Telegram API Credentials** from [my.telegram.org](https://my.telegram.org)

### Step 1: Clone Repository

```bash
git clone https://github.com/chelaxian/tg-ytdlp-bot.git
cd tg-ytdlp-bot
```

### Step 2: Install Dependencies

```bash
# Update system packages
sudo apt update
sudo apt install -y git python3.10 python3-pip python3.10-venv mediainfo rsync

# Create virtual environment
python3 -m venv venv
source venv/bin/activate

# Install Python packages
pip install --no-cache-dir -r requirements.txt
```

### Step 3: Install FFmpeg

```bash
# Install FFmpeg (required for video processing)
sudo apt-get install -y ffmpeg

# Verify installation
ffmpeg -version
```

### Step 4: Setup Configuration

```bash
# Navigate to config directory
cd CONFIG

# Copy template configuration
cp _config.py config.py

# Edit configuration
nano config.py
```

### Step 5: Start the Bot

```bash
# Activate virtual environment
source venv/bin/activate

# Start the bot
python3 magic.py
```

## Getting API Credentials

For more detailed configuration information, see the [Configuration documentation](../configuration/configuration.md).

### 1. Bot Token
1. Message [@BotFather](https://t.me/BotFather)
2. Create a new bot with `/newbot`
3. Copy the bot token

### 2. API ID & Hash
1. Visit [my.telegram.org](https://my.telegram.org)
2. Log in with your phone number
3. Go to "API development tools"
4. Create a new application
5. Copy API ID and API Hash

### 3. Channel IDs
1. Create channels and add your bot as admin
2. Get channel IDs using [@userinfobot](https://t.me/userinfobot)
3. Channel IDs start with `-100`

### 4. User ID
1. Message [@UserInfoToBot](https://t.me/UserInfoToBot)
2. Copy your user ID
3. Add to `ADMIN` list in config.py

## Cookie Setup

1. Use [Cookie-Editor](https://chromewebstore.google.com/detail/cookie-editor/hlkenndednhfkekhgcdicdfddnkalmdm) browser extension
2. Export cookies in Netscape format
3. Upload to web server (HTTPS required)
4. Update cookie URLs in config.py
5. Files must be under 100KB and accessible without authentication

## Installing ffmpeg (example for Ubuntu/Debian)

You also need to install `ffmpeg` https://github.com/btbn/ffmpeg-builds/releases
**ffmpeg** is essential since **yt-dlp** relies on it for merging streams (and in some cases for transcoding or extracting thumbnails). Also ffmpeg is needed for embedding subtitles and for splitting bigger than 2gb videos into parts. To install ffmpeg on a Debian-based system, run:

```sh
sudo apt-get update
sudo apt-get install -y ffmpeg
```

Verify the installation:
```sh
ffmpeg -version
```

## (Optional) Arabic and Asian fonts

<details>
   <summary>Details</summary>

If you need to support extra languages such as arabic, chinese, japanese, korean - you also need to install this language packs:
   ```sh
   sudo apt update
   sudo add-apt-repository universe
   sudo apt update

   sudo apt install fonts-noto-core             # ‚Äì Noto Sans, Noto Serif, ‚Ä¶ base fonts Google Noto
   sudo apt install fonts-noto-extra            # ‚Äì extra fonts (including arabic)
   sudo apt install fonts-kacst fonts-kacst-one # ‚Äì KACST arabic fonts
   sudo apt install fonts-noto-cjk              # ‚Äì Chinese-Japanese-Korean characters
   sudo apt install fonts-indic                 # ‚Äì extra indian fonts

   sudo apt install fonts-noto-color-emoji fontconfig libass9
   ```

   For Amiri arabic:
   ```sh
   git clone https://github.com/aliftype/amiri.git
   sudo mkdir -p /usr/share/fonts/truetype/amiri
   sudo cp amiri/fonts/*.ttf /usr/share/fonts/truetype/amiri/
   ```

   Update font cache
   ```sh
   sudo fc-cache -fv
   fc-list | grep -i amiri
   ```
</details>

## (Optional) Preparing `yt-dlp` for `/cookies_from_browser`

<details>
   <summary>Details</summary>

   To use the `/cookies_from_browser` command (which extracts cookies from installed browsers on your server), ensure that the **yt-dlp** binary is set up properly:

   1. **Download `yt-dlp`**
      Visit the [official `yt-dlp` releases page](https://github.com/yt-dlp/yt-dlp/releases) and download the binary for your CPU architecture (e.g., `yt-dlp_x86_64`, `yt-dlp_arm`, etc.).
      Place the binary executable in the `tg-ytdlp-bot` project folder.

  2. **Rename and make it executable**
     ```bash
     mv yt-dlp_linux yt-dlp
     chmod +x yt-dlp
     ```

   3. **Create a symbolic link**
      Create a symlink so that `yt-dlp` can be run from any directory (for example, in `/usr/local/bin`):
      ```bash
      sudo ln -s /full/path/to/tg-ytdlp-bot/yt-dlp /usr/local/bin/yt-dlp
      ```
      Ensure `/usr/local/bin` is in your `PATH`. Now you can run `yt-dlp` directly.

   (Also in that case you must install desktop environment (GUI) and any supported by `yt-dlp` browser by yourself)

</details>

## Get YouTube cookies

YouTube rotates account cookies frequently on open YouTube browser tabs as a security measure. To export cookies that will remain working with yt-dlp, you will need to export cookies in such a way that they are never rotated.

One way to do this is through a private browsing/incognito window:

- Open a new private browsing/incognito window and log into YouTube
- In same window and same tab from step 1, navigate to https://www.youtube.com/robots.txt (this should be the only private/incognito browsing tab open)
- Export youtube.com cookies from the browser, then close the private browsing/incognito window so that the session is never opened in the browser again.

For export you can use browser extension [Cookie-Editor](https://chromewebstore.google.com/detail/cookie-editor/hlkenndednhfkekhgcdicdfddnkalmdm)

Create in project folder subfolder `TXT` and place `cookie.txt` extracted from YouTube here

```sh
cd tg-ytdlp-bot/TXT
nano cookie.txt
```

## Advanced YouTube Cookie Management

The bot now supports automatic downloading and validation of YouTube cookies from multiple sources:

For more information about cookie commands, see the [User Commands documentation](../commands/user-commands.md#cookie-commands).

**Features:**
- **Multiple Sources**: Configure up to 10 different cookie sources
- **Automatic Validation**: Each downloaded cookie is tested for functionality
- **Fallback System**: If one source fails, automatically tries the next
- **Real-time Progress**: Shows download and validation progress to users

**Configuration in `CONFIG/config.py`:**
```python
# YouTube cookies URLs - main URL and backups
# The bot will check cookies in the order: YOUTUBE_COOKIE_URL, YOUTUBE_COOKIE_URL_1, YOUTUBE_COOKIE_URL_2, etc.
# If one URL does not work or the cookies are expired, the bot will automatically try the next one
YOUTUBE_COOKIE_URL = "https://your-domain.com/cookies/youtube/cookie1.txt"
YOUTUBE_COOKIE_URL_1 = "https://your-domain.com/cookies/youtube/cookie2.txt"
YOUTUBE_COOKIE_URL_2 = "https://your-domain.com/cookies/youtube/cookie3.txt"
YOUTUBE_COOKIE_URL_3 = "https://your-domain.com/cookies/youtube/cookie4.txt"
YOUTUBE_COOKIE_URL_4 = "https://your-domain.com/cookies/youtube/cookie5.txt"
# Add more sources as needed (up to YOUTUBE_COOKIE_URL_9)
```

**How it works:**
1. User runs `/cookie` and selects YouTube
2. Bot downloads cookies from the first available source
3. Validates cookies by testing them with a YouTube video
4. If validation fails, automatically tries the next source
5. Continues until working cookies are found or all sources are exhausted

**User Experience:**
- Progress updates: "üîÑ Downloading and checking YouTube cookies... Attempt 1 of 4"
- Success message: "‚úÖ YouTube cookies successfully downloaded and validated! Used source 2 of 4"
- Failure message: "‚ùå All YouTube cookies are expired or unavailable! Contact the bot administrator to replace them."

Also you may fill in `porn_domains.txt` `porn_keywords.txt` files in `TXT` folder if you want to tag #nsfw videos and hide them under spoiler